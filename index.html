<head>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
</head>

<script>
    client = new Paho.MQTT.Client("mqtt.eclipseprojects.io/mqtt", 443, "hey");
	// set callback handlers
	client.onConnectionLost = onConnectionLost;
	client.onMessageArrived = onMessageArrived;

	// connect the client
	client.connect({onSuccess:onConnect, useSSL: true});
	

	// called when the client connects
	async function onConnect() {
		// Once a connection has been made, make a subscription and send a message.
		console.log("onConnect");
		await client.subscribe("676Foot/pong")

		ping();
	}

	// called when the client loses its connection
	
	function onConnectionLost(responseObject) {
		if (responseObject.errorCode !== 0) {
			console.log("onConnectionLost:"+responseObject.errorMessage);

		}

		// client.connect({onSuccess:onConnect});
	}

	function ping() {
		console.log("pinging")
		message = new Paho.MQTT.Message("x");
		message.destinationName = "676Foot/ping";
		client.send(message);
		
	}  

	// called when a message arrives
	function onMessageArrived(message_obj) {
		console.log("onMessageArrived:"+message_obj.payloadString);

		let message = JSON.parse(message_obj.payloadString);
		
		console.log(message)

		if (message['Nathan']) {
			document.getElementById("nathan_status").innerHTML = "‚úÖ"
		} else {
            document.getElementById("nathan_status").innerHTML = "‚ùå"
        }

		if (message['Elijah']) {
			document.getElementById("elijah_status").innerHTML = "‚úÖ"
		} else {
            document.getElementById("elijah_status").innerHTML = "‚ùå"
        }

		if (message['Dominic']) {
			document.getElementById("dominic_status").innerHTML = "‚úÖ"
		} else {
            document.getElementById("dominic_status").innerHTML = "‚ùå"
        }
	}
</script>

<body>
    <h1 class="typewriter">Are we home? üè†</h1>
	<table>
		<tr class="status_line">
			<td class="status">Nathan</td> 
			<td class="status" id="nathan_status">
				<img src="loader.gif" style="width:15px">
			</td>
		</tr>
	
		<tr class="status_line">
			<td class="status">Dominic</td> 
			<td class="status" id="dominic_status">
				<img src="loader.gif" style="width:15px">
			</td>
		</tr>
	
	
		<tr class="status_line">
			<td class="status">Elijah</td> 
			<td class="status" id="elijah_status">
				<img src="loader.gif" style="width:15px">
			</td>
		</tr>
	</table>
	
    
	<h3 id="elijah_status"></h3>
	<h3 id="dominic_status"></h3>

</body>

<style>
    body {
        font-family: 'Source Code Pro';
		text-align: center;
		padding: 20%;
    }
	
	table {
		margin-left: auto;
 		margin-right: auto;
	}

	td {
		padding: 13px;
		width: 40px;
	}


	.typewriter h1 {
		overflow: hidden; /* Ensures the content is not revealed until the animation */
		border-right: .15em solid orange; /* The typwriter cursor */
		white-space: nowrap; /* Keeps the content on a single line */
		margin: 0 auto; /* Gives that scrolling effect as the typing happens */
		letter-spacing: .15em; /* Adjust as needed */
		animation: 
			typing 3.5s steps(40, end),
			blink-caret .75s step-end infinite;
	}

	/* The typing effect */
	@keyframes typing {
		from { width: 0 }
		to { width: 100% }
	}

	/* The typewriter cursor effect */
	@keyframes blink-caret {
		from, to { border-color: transparent }
		50% { border-color: orange; }
	}
</style>